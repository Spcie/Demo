#include "sys.h"
#include "delay.h"
#include "lcd22.h"
#include "font.h" 
/****************************************************************************************
2.2 TFT LCD Çı¶¯  
ÆÁÄ»·Ö±æÂÊÎª 240*320
Õ¼ÓÃ×ÊÔ´£ºSPI1 PA3 PA4 PA5(SCK) PA6(MISO) PA7(MOSI)
½ÓÏß·½Ê½£ºMISO-PA6 LED-VCC SCK-PA5 MOSI-PA7 DC-PA4 RESET-PA3 CS-GND 
LCDµÄ±³¹âµçÔ´¿ÉÒÔÓÉIO¿ÚÀ­¸ßÌá¹©
ÊÊÓÃÓÚ STM32f103RBT6 STM32f103RCT6 STM32f103ZET6
By Spice
2014.8.25
****************************************************************************************/
/*************************************ºê¶¨Òå********************************************/
#define  LCD22_DC1    {PAout(4) = 1;}                                                  //Êı¾İÄ£Ê½
#define  LCD22_DC0    {PAout(4) = 0;}                                                  //ÃüÁîÄ£Ê½
#define  LCD22_REST1  {PAout(3) = 1;}
#define  LCD22_REST0  {PAout(3) = 0;}

#define LCD_W 320
#define LCD_H 240
/************************************±äÁ¿ÉùÃ÷*******************************************/
u16 PointColor=0x0000;	//»­±ÊÑÕÉ«
u16 BackColor=0xFFFF;  //±³¾°É« 

const unsigned char shuzi3216[]={                                                     //Êı×Ö×Ö¿â
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x03,0x20,0x04,   
0x10,0x08,0x10,0x08,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,
0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x10,0x08,0x10,0x08,0x20,0x04,0xC0,0x03,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"0",0*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x01,0xE0,0x01,
0x18,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0xF8,0x3F,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"1",1*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x03,0x30,0x0C,
0x10,0x08,0x08,0x10,0x08,0x10,0x00,0x10,0x00,0x10,0x00,0x08,0x00,0x04,0x00,0x02,
0x00,0x01,0x80,0x00,0x40,0x00,0x20,0x00,0x10,0x00,0x08,0x00,0x04,0x10,0xFC,0x1F,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"2",2*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x03,0x30,0x06,
0x08,0x0C,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x04,0x80,0x03,0x00,0x04,
0x00,0x08,0x00,0x10,0x00,0x10,0x00,0x10,0x00,0x10,0x0C,0x08,0x18,0x04,0xE0,0x03,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"3",3*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x00,0x05,
0x00,0x05,0x80,0x04,0x80,0x04,0x40,0x04,0x40,0x04,0x20,0x04,0x20,0x04,0x10,0x04,
0x10,0x04,0x08,0x04,0xF8,0x1F,0x00,0x04,0x00,0x04,0x00,0x04,0x00,0x04,0x80,0x1F,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"4",4*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF8,0x07,0x08,0x00,
0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0xE8,0x03,0x18,0x04,0x00,0x08,0x00,0x10,
0x00,0x10,0x00,0x10,0x00,0x10,0x00,0x10,0x00,0x08,0x04,0x08,0x08,0x06,0xF0,0x01,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"5",5*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3E,0x00,0x21,
0xC0,0x00,0x20,0x00,0x10,0x00,0x10,0x00,0x10,0x00,0x10,0x07,0xD0,0x18,0x50,0x10,
0x30,0x20,0x10,0x20,0x10,0x20,0x10,0x20,0x20,0x20,0x20,0x10,0x40,0x18,0x80,0x07,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"6",6*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF8,0x0F,0x08,0x08,
0x08,0x08,0x00,0x08,0x00,0x04,0x00,0x04,0x00,0x04,0x00,0x04,0x00,0x02,0x00,0x02,
0x00,0x02,0x00,0x03,0x00,0x01,0x00,0x01,0x00,0x01,0x80,0x01,0x80,0x00,0x80,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"7",7*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x03,0x30,0x0C,
0x10,0x08,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x10,0x08,0xE0,0x07,0x10,0x08,
0x08,0x08,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x10,0x08,0x30,0x0C,0xC0,0x03,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"8",8*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x07,0x60,0x08,
0x20,0x10,0x10,0x10,0x10,0x10,0x10,0x20,0x10,0x20,0x10,0x30,0x20,0x30,0x60,0x28,
0x80,0x27,0x00,0x20,0x00,0x20,0x00,0x10,0x00,0x10,0x00,0x08,0x00,0x06,0xF0,0x01,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"9",9*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x80,0x01,0x80,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x01,0x80,0x01,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*":",10*/
//??????
0x00,0x00,0xFE,0x7F,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,
0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,
0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,
0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0xFE,0x7F,0x00,0x00,

0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x00,

0x00,0x00,0xFE,0x7F,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,
0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0xFE,0x7F,
0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,
0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0xFE,0x7F,0x00,0x00,

0x00,0x00,0xFE,0x7F,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,
0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0xFE,0x7F,
0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,
0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0xFE,0x7F,0x00,0x00,

0x00,0x00,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,
0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0xFE,0x7F,
0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,
0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x00,

0x00,0x00,0xFE,0x7F,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,
0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0xFE,0x7F,
0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,
0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0xFE,0x7F,0x00,0x00,

0x00,0x00,0xFE,0x7F,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,
0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0xFE,0x7F,
0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,
0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0xFE,0x7F,0x00,0x00,

0x00,0x00,0xFE,0x7F,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,
0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,
0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,
0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x00,

0x00,0x00,0xFE,0x7F,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,
0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0xFE,0x7F,
0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,
0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0xFE,0x7F,0x00,0x00,

0x00,0x00,0xFE,0x7F,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,
0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0xFE,0x7F,
0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,
0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0xFE,0x7F,0x00,0x00,

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x80,0x01,0x80,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x01,0x80,0x01,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};
/************************************º¯ÊıÉùÃû*******************************************/
void SPI1_SetSpeed(u8 SpeedSet);
u8 SPI1_ReadWriteByte(u8 TxData);
int SPI1_Init(void);
void LCDWriteBus(char dat);
void LCDWriteData8(unsigned char dat);
void LCDWriteData(unsigned dat);
void LCDWriteReg(unsigned char reg);
void LCDWriteDataReg(unsigned reg,unsigned dat);
void Address_set(unsigned x1,unsigned y1,unsigned x2,unsigned y2);
u32 LCD_Pow(u8 m,u8 n);
/****************************************************************************************
º¯ÊıÃû£ºSPI1_Init
ÃèÊö£ºSTM32 SPI1¼°ÏàÓ¦IO¿ÚÉèÖÃ
ÊäÈë£ºÎŞ
Êä³ö£º0
****************************************************************************************/
int SPI1_Init(void)
{
	GPIO_InitTypeDef GPIO_InitStructure;
	SPI_InitTypeDef  SPI_InitStructure;
	
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_SPI1|RCC_APB2Periph_GPIOA,ENABLE);              //´ò¿ªSPI1ºÍPAµÄÊ±ÖÓ
	
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_5 | GPIO_Pin_6 | GPIO_Pin_7 ;                  //SCLK,MISO,MOSI
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;                                       //¸´ÓÃÍÆÍìÊä³ö
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
	GPIO_Init(GPIOA,&GPIO_InitStructure);
	
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_4 | GPIO_Pin_3;                                //DC   RST
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;                                      //ÍÆÍìÊä³ö
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;                                    
	GPIO_Init(GPIOA,&GPIO_InitStructure);
	
	SPI_InitStructure.SPI_Direction = SPI_Direction_2Lines_FullDuplex;                    //ÉèÖÃSPIµ¥Ïò»òÕßË«ÏòµÄÊı¾İÄ£Ê½:SPIÉèÖÃÎªË«ÏßË«ÏòÈ«Ë«¹¤
	SPI_InitStructure.SPI_Mode = SPI_Mode_Master;		                                      //ÉèÖÃSPI¹¤×÷Ä£Ê½:ÉèÖÃÎªÖ÷SPI
	SPI_InitStructure.SPI_DataSize = SPI_DataSize_8b;	                                  	//ÉèÖÃSPIµÄÊı¾İ´óĞ¡:SPI·¢ËÍ½ÓÊÕ8Î»Ö¡½á¹¹
	SPI_InitStructure.SPI_CPOL = SPI_CPOL_High;		                                        //Ñ¡ÔñÁË´®ĞĞÊ±ÖÓµÄÎÈÌ¬:Ê±ÖÓĞü¿Õ¸ß
	SPI_InitStructure.SPI_CPHA = SPI_CPHA_2Edge;                                        	//Êı¾İ²¶»ñÓÚµÚ¶ş¸öÊ±ÖÓÑØ
	SPI_InitStructure.SPI_NSS = SPI_NSS_Soft;		                                          //NSSĞÅºÅÓÉÓ²¼ş£¨NSS¹Ü½Å£©»¹ÊÇÈí¼ş£¨Ê¹ÓÃSSIÎ»£©¹ÜÀí:ÄÚ²¿NSSĞÅºÅÓĞSSIÎ»¿ØÖÆ
	SPI_InitStructure.SPI_BaudRatePrescaler = SPI_BaudRatePrescaler_8;	                	//¶¨Òå²¨ÌØÂÊÔ¤·ÖÆµµÄÖµ:²¨ÌØÂÊÔ¤·ÖÆµÖµÎª8
	SPI_InitStructure.SPI_FirstBit = SPI_FirstBit_MSB;	                                  //Ö¸¶¨Êı¾İ´«Êä´ÓMSBÎ»»¹ÊÇLSBÎ»¿ªÊ¼:Êı¾İ´«Êä´ÓMSBÎ»¿ªÊ¼
	SPI_InitStructure.SPI_CRCPolynomial = 7;	                                            //CRCÖµ¼ÆËãµÄ¶àÏîÊ½
	SPI_Init(SPI1, &SPI_InitStructure);                                                   //¸ù¾İSPI_InitStructÖĞÖ¸¶¨µÄ²ÎÊı³õÊ¼»¯ÍâÉèSPIx¼Ä´æÆ÷
	
	SPI_Cmd(SPI1, ENABLE);                                                                //Ê¹ÄÜSPIÍâÉè
	SPI1_ReadWriteByte(0xff);                                                             //Æô¶¯´«Êä		 
	return 0;
}
/****************************************************************************************
º¯ÊıÃû£ºSPI1_SetSpeed
ÃèÊö£ºSPI1´«ÊäËÙÂÊÉè¶¨
ÊäÈë£ºSPI_BaudRatePrescaler_2   2·ÖÆµ   (SPI 36M@sys 72M)  
      SPI_BaudRatePrescaler_8   8·ÖÆµ   (SPI 9M@sys 72M) 
      SPI_BaudRatePrescaler_16  16·ÖÆµ  (SPI 4.5M@sys 72M) 
      SPI_BaudRatePrescaler_256 256·ÖÆµ (SPI 281.25K@sys 72M)
Êä³ö£ºÎŞ
****************************************************************************************/
void SPI1_SetSpeed(u8 SpeedSet)
{
	SPI_InitTypeDef  SPI_InitStructure;
	SPI_InitStructure.SPI_BaudRatePrescaler = SpeedSet ;
  SPI_Init(SPI1, &SPI_InitStructure);
	SPI_Cmd(SPI1,ENABLE);
} 
/****************************************************************************************
º¯ÊıÃû£ºSPI1_ReadWriteByte
ÃèÊö£ºÍ¨¹ıSPI1·¢ËÍ»ò¶ÁÈ¡Ò»¸ö×Ö½Ú
ÊäÈë£ºTxData:Òª·¢ËÍµÄ×Ö½Ú
Êä³ö£º¶ÁÈ¡µ½µÄ×Ö½Ú
****************************************************************************************/
u8 SPI1_ReadWriteByte(u8 TxData)
{		
	u8 retry=0;				 	
	while (SPI_I2S_GetFlagStatus(SPI1, SPI_I2S_FLAG_TXE) == RESET) //¼ì²éÖ¸¶¨µÄSPI±êÖ¾Î»ÉèÖÃÓë·ñ:·¢ËÍ»º´æ¿Õ±êÖ¾Î»
		{
		retry++;
		if(retry>200)return 0;
		}			  
	SPI_I2S_SendData(SPI1, TxData); //Í¨¹ıÍâÉèSPIx·¢ËÍÒ»¸öÊı¾İ
	retry=0;

	while (SPI_I2S_GetFlagStatus(SPI1, SPI_I2S_FLAG_RXNE) == RESET)//¼ì²éÖ¸¶¨µÄSPI±êÖ¾Î»ÉèÖÃÓë·ñ:½ÓÊÜ»º´æ·Ç¿Õ±êÖ¾Î»
		{
		retry++;
		if(retry>200)return 0;
		}	  						    
	return SPI_I2S_ReceiveData(SPI1); //·µ»ØÍ¨¹ıSPIx×î½ü½ÓÊÕµÄÊı¾İ					    
}
/****************************************************************************************
º¯ÊıÃû£ºLCDWriteBus
ÃèÊö£ºÍ¨¹ıSPIÏß·¢ËÍ8bitµÄÊı¾İ
ÊäÈë£ºdat £º·¢ËÍµÄÊı¾İ
Êä³ö£ºÎŞ
****************************************************************************************/
void LCDWriteBus(char dat)
{
	SPI1_ReadWriteByte(dat);
}

/****************************************************************************************
º¯ÊıÃû£ºLCDWriteData8
ÃèÊö£º·¢ËÍ8bitµÄÊı¾İ
ÊäÈë£ºdat£º·¢ËÍµÄÊı¾İ
Êä³ö£ºÎŞ
****************************************************************************************/
void LCDWriteData8(unsigned char dat)
{
	LCD22_DC1;
	LCDWriteBus(dat);
}
/****************************************************************************************
º¯ÊıÃû£ºLCDWriteData
ÃèÊö£º·¢ËÍÒ»¸ö16bitµÄÊı¾İ
ÊäÈë£ºdat ·¢ËÍµÄÊı¾İ
Êä³ö£º
****************************************************************************************/
void LCDWriteData(unsigned dat)
{
	LCD22_DC1;
	LCDWriteBus(dat>>8);                                      //·¢ËÍ¸ß8Î»
	LCDWriteBus(dat);                                         //·¢ËÍµÍ8Î»
}
/****************************************************************************************
º¯ÊıÃû£ºLCDWriteReg
ÃèÊö£º·¢ËÍÒ»¸öÃüÁî
ÊäÈë£ºreg ·¢ËÍµÄÃüÁî
Êä³ö£ºÎŞ
****************************************************************************************/
void LCDWriteReg(unsigned char reg)
{
	LCD22_DC0;
	LCDWriteBus(reg);
}
/****************************************************************************************
º¯ÊıÃû£ºLCDWriteDataReg
ÃèÊö£ºÍ¬Ê±·¢ËÍÒ»¸öÊı¾İºÍÃüÁî
ÊäÈë£ºreg ÃüÁî datÊı¾İ
Êä³ö£ºÎŞ
****************************************************************************************/
void LCDWriteDataReg(unsigned reg,unsigned dat)
{
	LCDWriteReg(reg);
	LCDWriteData(dat);
}
/****************************************************************************************
º¯ÊıÃû£ºAddress_set
ÃèÊö£º×ø±êÉè¶¨
ÊäÈë£ºx1£¬y1 ÆğÊ¼×ø±ê   x2£¬y2 ½áÊø×ø±ê
Êä³ö£ºÎŞ
****************************************************************************************/
void Address_set(unsigned x1,unsigned y1,unsigned x2,unsigned y2)
{
	LCDWriteReg(0x2a);
	LCDWriteData8(x1>>8);
	LCDWriteData8(x1&0xff);
	LCDWriteData8(x2>>8);
	LCDWriteData8(x2&0xff);
	
	LCDWriteReg(0x2b);
	LCDWriteData8(y1>>8);
	LCDWriteData8(y1&0xff);
	LCDWriteData8(y2>>8);
	LCDWriteData8(y2&0xff);
	
	LCDWriteReg(0x2c);	
}
/****************************************************************************************
º¯ÊıÃû£ºLCD22_Init
ÃèÊö£ºLCD³õÊ¼»¯
ÊäÈë£ºÎŞ
Êä³ö£º0
****************************************************************************************/
int LCD22_Init(void)
{
	SPI1_Init();
	
	LCD22_REST1;
	delay_ms(1);
	LCD22_REST0;
	delay_ms(10);
	LCD22_REST1;
	delay_ms(120);
	
	LCDWriteReg(0x11);
  LCDWriteReg(0x29);
  LCDWriteReg(0x2c);
  
  LCDWriteReg(0xCB);
  LCDWriteData8(0x39); 
  LCDWriteData8(0x2C); 
  LCDWriteData8(0x00); 
  LCDWriteData8(0x34); 
  LCDWriteData8(0x02);
  
  LCDWriteReg(0xCF);
  LCDWriteData8(0x00);
  LCDWriteData8(0XC1);
  LCDWriteData8(0X30);
  
  LCDWriteReg(0xE8);
  LCDWriteData8(0x85);
  LCDWriteData8(0x00);
  LCDWriteData8(0x78);
  
  LCDWriteReg(0xEA);
  LCDWriteData8(0x00);
  LCDWriteData8(0x00);
  
  LCDWriteReg(0xED);
  LCDWriteData8(0x64);
  LCDWriteData8(0x03);
  LCDWriteData8(0X12);
  LCDWriteData8(0X81);
  
  LCDWriteReg(0xF7);
  LCDWriteData8(0x20);
  
  LCDWriteReg(0xC0);    //Power control
  LCDWriteData8(0x23);   //VRH[5:0] 
  
  LCDWriteReg(0xC1);    //Power control 
  LCDWriteData8(0x10);   //SAP[2:0];BT[3:0]
  
  LCDWriteReg(0xC5);    //VCM control 
  LCDWriteData8(0x3e); //??±è?èµ÷?ú
  LCDWriteData8(0x28); 
  
  LCDWriteReg(0xC7);    //VCM control2 
  LCDWriteData8(0x86);  //--
  
  LCDWriteReg(0x36);    // Memory Access Control 
  LCDWriteData8(0x48); //C8	   //48 68êú?á//28 E8 oá?á
  
  LCDWriteReg(0x3A);
  LCDWriteData8(0x55); 
  
  LCDWriteReg(0xB1);
  LCDWriteData8(0x00);
  LCDWriteData8(0x18);
  
  LCDWriteReg(0xB6);    // Display Function Control
  LCDWriteData8(0x08);
  LCDWriteData8(0x82);
  LCDWriteData8(0x27);
  
  LCDWriteReg(0xF2);    // 3Gamma Function Disable 
  LCDWriteData8(0x00); 

  LCDWriteReg(0x26);    //Gamma curve selected 
  LCDWriteData8(0x01);
  
  LCDWriteReg(0xE0);    //Set Gamma
  LCDWriteData8(0x0F); 
  LCDWriteData8(0x31);
  LCDWriteData8(0x2B);
  LCDWriteData8(0x0C);
  LCDWriteData8(0x0E);
  LCDWriteData8(0x08);
  LCDWriteData8(0x4E);
  LCDWriteData8(0xF1);
  LCDWriteData8(0x37);
  LCDWriteData8(0x07);
  LCDWriteData8(0x10);
  LCDWriteData8(0x03);
  LCDWriteData8(0x0E);
  LCDWriteData8(0x09);
  LCDWriteData8(0x00);
  
  LCDWriteReg(0XE1);    //Set Gamma
  LCDWriteData8(0x00);
  LCDWriteData8(0x0E);
  LCDWriteData8(0x14);
  LCDWriteData8(0x03);
  LCDWriteData8(0x11);
  LCDWriteData8(0x07);
  LCDWriteData8(0x31);
  LCDWriteData8(0xC1);
  LCDWriteData8(0x48);
  LCDWriteData8(0x08);
  LCDWriteData8(0x0F);
  LCDWriteData8(0x0C);
  LCDWriteData8(0x31);
  LCDWriteData8(0x36);
  LCDWriteData8(0x0F);
  
  LCDWriteReg(0x11);    //Exit Sleep
  LCDWriteReg(0x29);    //Display on
  LCDWriteReg(0x2c);
	return 0;
}
/****************************************************************************************
º¯ÊıÃû£ºLCD22_Clear
ÃèÊö£ºË¢ÆÁ
ÊäÈë£ºColor Ë¢ÆÁµÄÑÕÉ«
Êä³ö£ºÎŞ
****************************************************************************************/
void LCD22_Clear(unsigned Color)
{
	unsigned char VH,VL;
	int i,j;
	VH = Color >> 8;
	VL = Color;
	Address_set(0,0,239,319);
	for(i=0;i<240;i++)
  {
    for (j=0;j<320;j++)
    {
      LCDWriteData8(VH);
      LCDWriteData8(VL);
    }
  }
	
}
/****************************************************************************************
º¯ÊıÃû£ºLCD22_DrawPoint
ÃèÊö£º»­µãº¯Êı
ÊäÈë£ºx,yµãµÄ×ø±ê Color µãµÄÑÕÉ«
Êä³ö£ºÎŞ
****************************************************************************************/
void LCD22_DrawPoint(unsigned int x,unsigned int y,u16 Color)
{
	Address_set(x,y,x,y);
	LCDWriteData(Color);
}
/****************************************************************************************
º¯ÊıÃû£ºLCD22_Fill
ÃèÊö£ºÖ¸¶¨ÇøÓòÌî³äÑÕÉ«
ÊäÈë£ºxsta£¬ysta£¬xend£¬yend ÇøÓò×ø±ê  color ÒªÌî³äµÄÑÕÉ«
Êä³ö£ºÎŞ
****************************************************************************************/
void LCD22_Fill(unsigned xsta,unsigned ysta,unsigned xend,unsigned yend,unsigned color)
{
	unsigned int i,j;
	Address_set(xsta,ysta,xend,yend);
	for(i = xsta;i <= yend;i++)
	  for(j = xsta;j <= xend;j++) LCDWriteData(color);
}
/****************************************************************************************
º¯ÊıÃû£ºLCD22_DrawBigPoint
ÃèÊö£º»­¸ö´óµÄµã
ÊäÈë£ºx,yµãµÄ×ø±ê Color µãµÄÑÕÉ«
Êä³ö£ºÎŞ
****************************************************************************************/
void LCD22_DrawBigPoint(unsigned x,unsigned y,unsigned int POINT_COLOR)
{
  LCD22_Fill(x-2,y-2,x+2,y+2,POINT_COLOR);
} 
/****************************************************************************************
º¯ÊıÃû£ºLCD22_DrawLine
ÃèÊö£º»­Ïßº¯Êı
ÊäÈë£ºx1£¬y1Æğµã×ø±ê x2£¬y2 ÖÕµã×ø±ê POINT_COLOR ÑÕÉ«
Êä³ö£ºÎŞ
****************************************************************************************/
void LCD22_DrawLine(unsigned x1, unsigned y1, unsigned x2, unsigned y2,unsigned int POINT_COLOR)
{
  unsigned t;
  int xerr=0,yerr=0,delta_x,delta_y,distance;
  int incx,incy,uRow,uCol;
  
  delta_x=x2-x1; //????×?±ê??á?
  delta_y=y2-y1;
  uRow=x1;
  uCol=y1;
  if(delta_x>0)incx=1; //éè??µ?2?·??ò 
  else if(delta_x==0)incx=0;//'1?±?? 
  else {incx=-1;delta_x=-delta_x;}
  if(delta_y>0)incy=1;
  else if(delta_y==0)incy=0;//??????
  else{incy=-1;delta_y=-delta_y;} 
  if( delta_x>delta_y)distance=delta_x; //??è??ù±???á?×?±ê?á 
  else distance=delta_y;
  for(t=0;t<=distance+1;t++ )//?-??ê?3? 
  {
    LCD22_DrawPoint(uRow,uCol,POINT_COLOR);//?-µ? 
    xerr+=delta_x ;
    yerr+=delta_y ;
    if(xerr>distance)
    {
      xerr-=distance;
      uRow+=incx;
    }
    if(yerr>distance)
    {
      yerr-=distance;
      uCol+=incy;
    }
  }  
} 
/****************************************************************************************
º¯ÊıÃû£ºLCD22_ClearLine
ÃèÊö£ºÇå³ı»®Ïß
ÊäÈë£ºx1£¬y1Æğµã×ø±ê x2£¬y2 ÖÕµã×ø±ê POINT_COLOR ÑÕÉ«
Êä³ö£ºÎŞ
****************************************************************************************/
void LCD22_ClearLine(unsigned x1, unsigned y1, unsigned x2, unsigned y2,unsigned int POINT_COLOR)
{
  unsigned t;
  int xerr=0,yerr=0,delta_x,delta_y,distance;
  int incx,incy,uRow,uCol;
  
  delta_x=x2-x1; //????×?±ê??á?
  delta_y=y2-y1;
  uRow=x1;
  uCol=y1;
  if(delta_x>0)incx=1; //éè??µ?2?·??ò 
  else if(delta_x==0)incx=0;//'1?±?? 
  else {incx=-1;delta_x=-delta_x;} 
  if(delta_y>0)incy=1;
  else if(delta_y==0)incy=0;//??????
  else{incy=-1;delta_y=-delta_y;}
  if( delta_x>delta_y)distance=delta_x; //??è??ù±???á?×?±ê?á
  else distance=delta_y;
  for(t=0;t<=distance+1;t++ )//?-??ê?3?
  {
    LCD22_DrawPoint(uRow,uCol,POINT_COLOR);//?-µ?
    xerr+=delta_x;
    yerr+=delta_y;
    if(xerr>distance)
    {
      xerr-=distance;
      uRow+=incx;
    }
    if(yerr>distance)
    {
      yerr-=distance;
      uCol+=incy;
    }
  }  
}
/****************************************************************************************
º¯ÊıÃû£ºLCD22_DrawRectangle
ÃèÊö£º»­¾ØĞÎ
ÊäÈë£ºx1£¬y1£¬x2£¬y2 ÇøÓò  POINT_COLOR ÑÕÉ«
Êä³ö£ºÎŞ
****************************************************************************************/
void LCD22_DrawRectangle(unsigned x1, unsigned y1, unsigned x2, unsigned y2,unsigned int POINT_COLOR)
{
  LCD22_DrawLine(x1,y1,x2,y1,POINT_COLOR);
  LCD22_DrawLine(x1,y1,x1,y2,POINT_COLOR);
  LCD22_DrawLine(x1,y2,x2,y2,POINT_COLOR);
  LCD22_DrawLine(x2,y1,x2,y2,POINT_COLOR);
}
/****************************************************************************************
º¯ÊıÃû£ºLCD22_DrawCircle
ÃèÊö£º»­Ô²
ÊäÈë£ºx0£¬y0 Ô²ĞÄ×ø±ê
Êä³ö£ºÎŞ
****************************************************************************************/
void LCD22_DrawCircle(unsigned x0,unsigned y0,unsigned char r,unsigned int POINT_COLOR)
{
  int a,b;
  int di;
  a=0;b=r;
  di=3-(r<<1);
  //di=5/4-r;
  while(a<=b)
  {
    LCD22_DrawPoint(x0-b,y0-a,POINT_COLOR);             //3
    LCD22_DrawPoint(x0+b,y0-a,POINT_COLOR);             //0
    LCD22_DrawPoint(x0-a,y0+b,POINT_COLOR);             //1
    LCD22_DrawPoint(x0-b,y0-a,POINT_COLOR);             //7
    LCD22_DrawPoint(x0-a,y0-b,POINT_COLOR);             //2
    LCD22_DrawPoint(x0+b,y0+a,POINT_COLOR);             //4
    LCD22_DrawPoint(x0+a,y0-b,POINT_COLOR);             //5
    LCD22_DrawPoint(x0+a,y0+b,POINT_COLOR);             //6
    LCD22_DrawPoint(x0-b,y0+a,POINT_COLOR);
    a++;
    //ê1ó?Bresenham??·¨?-?2
    if(di<0)di +=4*a+6;
    else
    {
      di+=10+4*(a-b);
      b--;
    }
    LCD22_DrawPoint(x0+a,y0+b,POINT_COLOR);
  }
} 
/****************************************************************************************
º¯ÊıÃû£ºLCD22_ShowChar
ÃèÊö£ºÏÔÊ¾Ò»¸ö×Ö·û
ÊäÈë£ºx£¬y×ø±ê num£º×Ö·ûµÄASCIIÂë size£º³ß´ç(Ò»°ãÑ¡16) mode £º1 ·Çµş¼Ó·½Ê½ 0£ºµş¼Ó·½Ê½
Êä³ö£ºÎŞ
****************************************************************************************/
void LCD22_ShowChar(u16 x,u16 y,u8 num,u8 size,u8 mode)
{  							  
    u8 temp,t1,t;
	u16 y0=y;
	u16 colortemp=PointColor;      			     
	//ÉèÖÃ´°¿Ú		   
	num=num-' ';//µÃµ½Æ«ÒÆºóµÄÖµ
	if(!mode) //·Çµş¼Ó·½Ê½
	{
	    for(t=0;t<size;t++)
	    {   
			if(size==12)temp=asc2_1206[num][t];  //µ÷ÓÃ1206×ÖÌå
			else temp=asc2_1608[num][t];		 //µ÷ÓÃ1608×ÖÌå 	                          
	        for(t1=0;t1<8;t1++)
			{			    
		        if(temp&0x80)PointColor=colortemp;
				else PointColor=BackColor;
				LCD22_DrawPoint(x,y,PointColor);	
				temp<<=1;
				y++;
				if(x>=LCD_W){PointColor=colortemp;return;}//³¬ÇøÓòÁË
				if((y-y0)==size)
				{
					y=y0;
					x++;
					if(x>=LCD_W){PointColor=colortemp;return;}//³¬ÇøÓòÁË
					break;
				}
			}  	 
	    }    
	}else//µş¼Ó·½Ê½
	{
	    for(t=0;t<size;t++)
	    {   
			if(size==12)temp=asc2_1206[num][t];  //µ÷ÓÃ1206×ÖÌå
			else temp=asc2_1608[num][t];		 //µ÷ÓÃ1608×ÖÌå 	                          
	        for(t1=0;t1<8;t1++)
			{			    
		        if(temp&0x80)LCD22_DrawPoint(x,y,PointColor); 
				temp<<=1;
				y++;
				if(x>=LCD_H){PointColor=colortemp;return;}//³¬ÇøÓòÁË
				if((y-y0)==size)
				{
					y=y0;
					x++;
					if(x>=LCD_W){PointColor=colortemp;return;}//³¬ÇøÓòÁË
					break;
				}
			}  	 
	    }     
	}
	PointColor=colortemp;	    	   	 	  
}   
/****************************************************************************************
º¯ÊıÃû£ºLCD22_ShowString
ÃèÊö£ºÏÔÊ¾Ò»¸ö×Ö·û´®
ÊäÈë£ºx£¬y×ø±ê width,height:ÇøÓò´óĞ¡  size:×ÖÌå´óĞ¡   *p:×Ö·û´®ÆğÊ¼µØÖ·		
Êä³ö£ºÎŞ
****************************************************************************************/
void LCD22_ShowString(u16 x,u16 y,u16 width,u16 height,u8 size,u8 *p)
{         
	u8 x0=x;
	width+=x;
	height+=y;
    while((*p<='~')&&(*p>=' '))//ÅĞ¶ÏÊÇ²»ÊÇ·Ç·¨×Ö·û!
    {       
        if(x>=width){x=x0;y+=size;}
        if(y>=height)break;//ÍË³ö
        LCD22_ShowChar(x,y,*p,size,0);
        x+=size/2;
        p++;
    }  
}


/****************************************************************************************
º¯ÊıÃû£ºnumber 
ÃèÊö£ºÏÔÊ¾Ò»¸öÊı×Ö 
ÊäÈë£ºx,y:Æğµã×ø±ê num:ÊıÖµ(0~999999999);	len:³¤¶È(¼´ÒªÏÔÊ¾µÄÎ»Êı) POINT_COLOR ×ÖÌåÑÕÉ«  BACK_COLOR±³¾°ÑÕÉ«
Êä³ö£ºÎŞ
****************************************************************************************/


void number(unsigned int x,unsigned int y,const unsigned char number,unsigned int POINT_COLOR,unsigned int BACK_COLOR)	
{
  unsigned char i,j;
  const unsigned char *temp=shuzi3216;
  Address_set(x,y,x+15,y+31);
  temp+=number*64;
  for(j=0;j<64;j++)
  {
    for(i=0;i<8;i++)
    {
      if((*temp&(1<<i))!=0)
        LCDWriteData(POINT_COLOR);
      else
       LCDWriteData(BACK_COLOR);
    }
    temp++;
  }
}
/****************************************************************************************
º¯ÊıÃû£ºLCD_Pow
ÃèÊö£ºmµÄn´Î·½
ÊäÈë£º²ÎÊı
Êä³ö£º½á¹û
****************************************************************************************/
u32 LCD_Pow(u8 m,u8 n)
{
	u32 result=1;	 
	while(n--)result*=m;    
	return result;
}			 
/****************************************************************************************
º¯ÊıÃû£ºLCD22_DrawCircle
ÃèÊö£ºÏÔÊ¾Ò»¸öÊı×Ö
ÊäÈë£ºx,y:Æğµã×ø±ê num:ÊıÖµ(0~999999999);	len:³¤¶È(¼´ÒªÏÔÊ¾µÄÎ»Êı) size:×ÖÌå´óĞ¡ 
Êä³ö£ºÎŞ
****************************************************************************************/
void LCD_ShowNum(u16 x,u16 y,u32 num,u8 len,u8 size)
{         	
	u8 t,temp;
	u8 enshow=0;						   
	for(t=0;t<len;t++)
	{
		temp=(num/LCD_Pow(10,len-t-1))%10;
		if(enshow==0&&t<(len-1))
		{
			if(temp==0)
			{
				LCD22_ShowChar(x+(size/2)*t,y,' ',size,0);
				continue;
			}else enshow=1; 
		 	 
		}
	 	LCD22_ShowChar(x+(size/2)*t,y,temp+'0',size,0); 
	}
} 


/******************************************½áÊø*******************************************/






